!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("AlloyFinger")):"function"==typeof define&&define.amd?define("VueMoCropper",["AlloyFinger"],e):"object"==typeof exports?exports.VueMoCropper=e(require("AlloyFinger")):t.VueMoCropper=e(t.AlloyFinger)}(window,(function(t){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n=i(1),r={install:function(t){t.component(n.default.name,n.default)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(r),e.default=r},function(t,e,i){"use strict";i.r(e);var n=i(2),r=i(4),o=(i(7),i(12)),s=Object(o.default)(r.default,n.render,n.staticRenderFns,!1,null,"1a7c0ba2",null);s.options.__file="src/mocropper.vue",e.default=s.exports},function(t,e,i){"use strict";i.r(e);var n=i(3);i.d(e,"render",(function(){return n.render})),i.d(e,"staticRenderFns",(function(){return n.staticRenderFns}))},function(t,e,i){"use strict";i.r(e),i.d(e,"render",(function(){return n})),i.d(e,"staticRenderFns",(function(){return r}));var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"cutout"},[i("canvas",{ref:"pCanvas",staticClass:"previewer"}),t._v(" "),t.showMask?i("div",{staticClass:"mask"}):t._e(),t._v(" "),i("div",{staticClass:"cropper-wrapper",style:{top:t.topY+"px",left:t.topX+"px",width:t.cropperWidth+"px",height:t.cropperHeight+"px"}},[i("canvas",{ref:"cCanvas",staticClass:"cropper"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle top-left"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle top-right"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle bottom-left"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle bottom-right"})]),t._v(" "),i("div",{ref:"gesture",staticClass:"gesture-layer",on:{touchmove:function(t){t.preventDefault()}}}),t._v(" "),t._t("default",[i("div",{staticClass:"menu"},[i("button",{staticClass:"menu_button cancel",on:{click:t.cancel}},[t._v(t._s(t.cancelText))]),t._v(" "),i("button",{staticClass:"menu_button confirm",on:{click:t.cropImage}},[t._v(t._s(t.confirmText))])])],{cancel:t.cancel,crop:t.cropImage})],2)},r=[];n._withStripped=!0},function(t,e,i){"use strict";i.r(e);var n=i(5);e.default=n.default},function(t,e,i){"use strict";i.r(e);var n=i(6),r=i.n(n);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s="top-left",a="top-right",c="bottom-left",p="bottom-right";e.default={name:"vue-mocropper",props:{visible:{type:Boolean,default:!1},cropWidth:{type:Number,default:200},cropHeight:{type:Number,default:200},src:{type:String,required:!0},outputMime:{type:String,default:"image/jpeg"},outputQuality:{type:Number,default:1},outputType:{type:String,default:"base64"},showMask:{type:Boolean,default:!0},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"裁剪"},resizable:{type:Boolean,default:!0}},data:function(){return{pCtx:null,cCtx:null,image:null,initWidth:0,initHeight:0,currentWidth:0,currentHeight:0,resizedWidth:0,resizedHeight:0,zoom:1,sX:null,sY:null,ratio:1,topX:0,topY:0,cropperWidth:this.cropWidth,cropperHeight:this.cropHeight,resizingCropper:!1,movingCropper:!1}},watch:{visible:function(t){t&&(this._reset(),this._loadImage())},src:function(t){this._reset(),t&&this._loadImage()}},methods:{_reset:function(){var t,e;this.image=null,this.initWidth=0,this.initHeight=0,this.currentWidth=0,this.currentHeight=0,this.resizedWidth=0,this.resizedHeight=0,this.zoom=1,this.sX=null,this.sY=null,this.cCtx=this.$refs.cCanvas.getContext("2d"),this.pCtx=this.$refs.pCanvas.getContext("2d"),this.ratio=(t=this.cCtx,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,(window.devicePixelRatio||1)/e),this.$refs.pCanvas.width=window.innerWidth*this.ratio,this.$refs.pCanvas.height=window.innerHeight*this.ratio,this._setcCanvasRect(),this._getCropperInitialPosition()},_setcCanvasRect:function(){this.$refs.cCanvas.width=this.cropperWidth*this.ratio,this.$refs.cCanvas.height=this.cropperHeight*this.ratio},_getCropperInitialPosition:function(){var t=window.innerWidth,e=window.innerHeight;this.topX=t/2-this.cropperWidth/2,this.topY=e/2-this.cropperHeight/2},_isInCropperArea:function(t,e){return t>=this.topX&&t<=this.topX+this.cropperWidth&&e>=this.topY&&e<=this.topY+this.cropperHeight},_isInCropperAngle:function(t,e){return t>=this.topX-10&&t<=this.topX+15+10&&e>=this.topY-10&&e<=this.topY+15+10?s:t>=this.topX+this.cropperWidth-7.5-10&&t<=this.topX+this.cropperWidth+7.5+10&&e>=this.topY-10&&e<=this.topY+15+10?a:t>=this.topX-10&&t<=this.topX+15+10&&e>=this.topY+this.cropperHeight-7.5-10&&e<=this.topY+this.cropperHeight-7.5+10?c:t>=this.topX+this.cropperWidth-7.5-10&&t<=this.topX+this.cropperWidth+7.5+10&&e>=this.topY+this.cropperHeight-7.5-10&&e<=this.topY+this.cropperHeight-7.5+10&&p},_resizeCropper:function(t,e){switch(this.resizingCropper){case s:this.topX+=t,this.topY+=e,this.cropperWidth-=t,this.cropperHeight-=e;break;case a:this.topY+=e,this.cropperWidth+=t,this.cropperHeight-=e;break;case c:this.topX+=t,this.cropperWidth-=t,this.cropperHeight+=e;break;case p:this.cropperWidth+=t,this.cropperHeight+=e}this._setcCanvasRect(),this._drawCanvas()},isInLegalArea:function(t,e){return t>=this.sX&&t<this.sX+this.currentWidth&&e>=this.sY&&e<this.sY+this.currentHeight},_moveCropper:function(t,e){var i=!1;this.topX+t>=0&&this.topX+t+this.cropperWidth<=window.innerWidth&&(this.topX+=t,i=!0),this.topY+e>=0&&this.topY+e+this.cropperHeight<=window.innerHeight&&(this.topY+=e,i=!0),i&&this._drawCanvas()},_adjustImageSize:function(){var t=1;this.initWidth>window.innerWidth&&(t=window.innerWidth/this.initWidth),this.initHeight>window.innerHeight&&(t=Math.min(t,window.innerHeight/this.initHeight)),this.zoom=t,this.currentWidth=this.zoom*this.initWidth,this.currentHeight=this.zoom*this.initHeight,this.resizedWidth=this.currentWidth,this.resizedHeight=this.currentHeight},_loadImage:function(){var t=this,e=new Image;e.setAttribute("crossOrigin","Anonymous"),e.src=this.src,e.onload=function(){t.image=e,t.initWidth=e.width,t.initHeight=e.height,t._adjustImageSize(),t._drawCanvas()},e.onerror=function(){t.$emit("load-failed")}},_getStartPoint:function(){var t=(window.innerWidth-this.currentWidth)/2,e=(window.innerHeight-this.currentHeight)/2;this.sX=t,this.sY=e},_drawCanvas:function(t,e){var i=this.cCtx,n=this.pCtx,r=this.ratio,s=this.$refs.pCanvas,a=function(t){return"object"===o(t)&&null===t};(a(this.sX)||a(this.sY))&&this._getStartPoint();var c=this.topY,p=this.topX;t=t||this.currentWidth,e=e||this.currentHeight,n.fillStyle="#000",n.fillRect(0,0,s.width,s.height),n.drawImage(this.image,0,0,this.initWidth,this.initHeight,this.sX*r,this.sY*r,t*r,e*r),i.drawImage(this.$refs.pCanvas,p*r,c*r,this.cropperWidth*r,this.cropperHeight*r,0,0,this.cropperWidth*r,this.cropperHeight*r)},cropImage:function(){var t=this;try{var e=function(e){var i=document.createElement("canvas");return i.width=e.width/t.ratio,i.height=e.height/t.ratio,i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),i}(this.$refs.cCanvas).toDataURL(this.outputMime,this.outputQuality);"blob"===this.outputType&&(e=function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],n=atob(e[1]),r=n.length,o=new Uint8Array(r);r--;)o[r]=n.charCodeAt(r);return new Blob([o],{type:i})}(e)),this.$emit("crop-done",e)}catch(t){this.$emit("crop-failed",t)}},cancel:function(){this.$emit("update:visible",!1)}},mounted:function(){var t=this,e=new r.a(this.$refs.gesture,{pressMove:function(e){var i=e.touches[0],n=i.clientX,r=i.clientY;return t.resizingCropper?t._resizeCropper(e.deltaX,e.deltaY):t.movingCropper?t._moveCropper(e.deltaX,e.deltaY):void(t.isInLegalArea(n,r)&&(t.sX+=e.deltaX,t.sY+=e.deltaY,t._drawCanvas()))},pinch:function(e){var i=e.zoom*t.currentWidth,n=e.zoom*t.currentHeight;i>2*t.initWidth||n>2*t.initHeight||(t.sX+=(t.resizedWidth-i)/2,t.sY+=(t.resizedHeight-n)/2,t.resizedWidth=i,t.resizedHeight=n,t._drawCanvas(t.resizedWidth,t.resizedHeight))},touchStart:function(e){var i=e.touches[0].clientX,n=e.touches[0].clientY;t.resizingCropper=t.resizable&&t._isInCropperAngle(i,n),t.movingCropper=t._isInCropperArea(i,n)},touchEnd:function(e){t.currentWidth=t.resizedWidth,t.currentHeight=t.resizedHeight,t.resizingCropper=!1,t.movingCropper=!1}});this.$on("hook:beforeDestory",(function(){e=e.destory()})),this._reset()}}},function(e,i){e.exports=t},function(t,e,i){"use strict";i.r(e);var n=i(8),r=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e.default=r.a},function(t,e,i){var n=i(9),r=i(10);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var o={insert:"head",singleton:!1},s=(n(r,o),r.locals?r.locals:{});t.exports=s},function(t,e,i){"use strict";var n,r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},o=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),s=[];function a(t){for(var e=-1,i=0;i<s.length;i++)if(s[i].identifier===t){e=i;break}return e}function c(t,e){for(var i={},n=[],r=0;r<t.length;r++){var o=t[r],c=e.base?o[0]+e.base:o[0],p=i[c]||0,u="".concat(c," ").concat(p);i[c]=p+1;var h=a(u),d={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(s[h].references++,s[h].updater(d)):s.push({identifier:u,updater:v(d,e),references:1}),n.push(u)}return n}function p(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var r=i.nc;r&&(n.nonce=r)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var s=o(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var u,h=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function d(t,e,i,n){var r=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=h(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function l(t,e,i){var n=i.css,r=i.media,o=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var f=null,g=0;function v(t,e){var i,n,r;if(e.singleton){var o=g++;i=f||(f=p(e)),n=d.bind(null,i,o,!1),r=d.bind(null,i,o,!0)}else i=p(e),n=l.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<i.length;n++){var r=a(i[n]);s[r].references--}for(var o=c(t,e),p=0;p<i.length;p++){var u=a(i[p]);0===s[u].references&&(s[u].updater(),s.splice(u,1))}i=o}}}},function(t,e,i){(e=i(11)(!1)).push([t.i,".cutout[data-v-1a7c0ba2] {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 9999;\n  background: #000;\n}\n.cutout .mask[data-v-1a7c0ba2] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    background: rgba(0, 0, 0, 0.4);\n}\n.cutout .previewer[data-v-1a7c0ba2] {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n}\n.cutout .cropper-wrapper[data-v-1a7c0ba2] {\n    position: absolute;\n    border: 1px solid #e7e7e7;\n}\n.cutout .cropper-wrapper .cropper[data-v-1a7c0ba2] {\n      width: 100%;\n      height: 100%;\n}\n.cutout .cropper-wrapper .cropper-angle[data-v-1a7c0ba2] {\n      position: absolute;\n      width: 15px;\n      height: 15px;\n      border: 3px solid #fff;\n      opacity: 0.8;\n}\n.cutout .cropper-wrapper .cropper-angle.top-left[data-v-1a7c0ba2] {\n        top: -3px;\n        left: -3px;\n        border-right: none;\n        border-bottom: none;\n}\n.cutout .cropper-wrapper .cropper-angle.top-right[data-v-1a7c0ba2] {\n        top: -3px;\n        right: -3px;\n        border-left: none;\n        border-bottom: none;\n}\n.cutout .cropper-wrapper .cropper-angle.bottom-left[data-v-1a7c0ba2] {\n        bottom: -3px;\n        left: -3px;\n        border-right: none;\n        border-top: none;\n}\n.cutout .cropper-wrapper .cropper-angle.bottom-right[data-v-1a7c0ba2] {\n        bottom: -3px;\n        right: -3px;\n        border-left: none;\n        border-top: none;\n}\n.cutout .gesture-layer[data-v-1a7c0ba2] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n}\n.cutout .menu[data-v-1a7c0ba2] {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 50px;\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    user-select: none;\n    background-color: rgba(255, 255, 255, 0.2);\n}\n.cutout .menu_button[data-v-1a7c0ba2] {\n      font-size: 20px;\n      padding: 5px 15px;\n      appearance: none;\n      outline: none;\n      border: none;\n      background: transparent;\n      color: #fff;\n}\n.cutout .menu_button.confirm[data-v-1a7c0ba2] {\n        color: #f77f7f;\n}\n.cutout .menu_button[data-v-1a7c0ba2]:active {\n        opacity: 0.5;\n}\n",""]),t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var r=(s=n,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),o=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[i].concat(o).concat([r]).join("\n")}var s,a,c;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,n){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(n)for(var o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<t.length;a++){var c=[].concat(t[a]);n&&r[c[0]]||(i&&(c[2]?c[2]="".concat(i," and ").concat(c[2]):c[2]=i),e.push(c))}},e}},function(t,e,i){"use strict";function n(t,e,i,n,r,o,s,a){var c,p="function"==typeof t?t.options:t;if(e&&(p.render=e,p.staticRenderFns=i,p._compiled=!0),n&&(p.functional=!0),o&&(p._scopeId="data-v-"+o),s?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},p._ssrRegister=c):r&&(c=a?function(){r.call(this,this.$root.$options.shadowRoot)}:r),c)if(p.functional){p._injectStyles=c;var u=p.render;p.render=function(t,e){return c.call(e),u(t,e)}}else{var h=p.beforeCreate;p.beforeCreate=h?[].concat(h,c):[c]}return{exports:t,options:p}}i.r(e),i.d(e,"default",(function(){return n}))}]).default}));