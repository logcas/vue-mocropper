!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("AlloyFinger")):"function"==typeof define&&define.amd?define("VueMoCropper",["AlloyFinger"],e):"object"==typeof exports?exports.VueMoCropper=e(require("AlloyFinger")):t.VueMoCropper=e(t.AlloyFinger)}(window,(function(t){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var r=i(1),n={install:function(t){t.component(r.default.name,r.default)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(n),e.default=n},function(t,e,i){"use strict";i.r(e);var r=i(2),n=i(4),o=(i(7),i(9)),s=Object(o.default)(n.default,r.render,r.staticRenderFns,!1,null,"1a7c0ba2",null);s.options.__file="src/mocropper.vue",e.default=s.exports},function(t,e,i){"use strict";i.r(e);var r=i(3);i.d(e,"render",(function(){return r.render})),i.d(e,"staticRenderFns",(function(){return r.staticRenderFns}))},function(t,e,i){"use strict";i.r(e),i.d(e,"render",(function(){return r})),i.d(e,"staticRenderFns",(function(){return n}));var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"cutout"},[i("canvas",{ref:"pCanvas",staticClass:"previewer"}),t._v(" "),t.showMask?i("div",{staticClass:"mask"}):t._e(),t._v(" "),i("div",{staticClass:"cropper-wrapper",style:{top:t.topY+"px",left:t.topX+"px",width:t.cropperWidth+"px",height:t.cropperHeight+"px"}},[i("canvas",{ref:"cCanvas",staticClass:"cropper"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle top-left"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle top-right"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle bottom-left"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.resizable,expression:"resizable"}],staticClass:"cropper-angle bottom-right"})]),t._v(" "),i("div",{ref:"gesture",staticClass:"gesture-layer",on:{touchmove:function(t){t.preventDefault()}}}),t._v(" "),t._t("default",[i("div",{staticClass:"menu"},[i("button",{staticClass:"menu_button cancel",on:{click:t.cancel}},[t._v(t._s(t.cancelText))]),t._v(" "),i("button",{staticClass:"menu_button confirm",on:{click:t.cropImage}},[t._v(t._s(t.confirmText))])])],{cancel:t.cancel,crop:t.cropImage})],2)},n=[];r._withStripped=!0},function(t,e,i){"use strict";i.r(e);var r=i(5);e.default=r.default},function(t,e,i){"use strict";i.r(e);var r=i(6),n=i.n(r);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var s="top-left",a="top-right",h="bottom-left",c="bottom-right";e.default={name:"vue-mocropper",props:{visible:{type:Boolean,default:!1},cropWidth:{type:Number,default:200},cropHeight:{type:Number,default:200},src:{type:String,required:!0},outputMime:{type:String,default:"image/jpeg"},outputQuality:{type:Number,default:1},outputType:{type:String,default:"base64"},showMask:{type:Boolean,default:!0},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"裁剪"},resizable:{type:Boolean,default:!0}},data:function(){return{pCtx:null,cCtx:null,image:null,initWidth:0,initHeight:0,currentWidth:0,currentHeight:0,resizedWidth:0,resizedHeight:0,zoom:1,sX:null,sY:null,ratio:1,topX:0,topY:0,cropperWidth:this.cropWidth,cropperHeight:this.cropHeight,resizingCropper:!1,movingCropper:!1}},watch:{visible:function(t){t&&(this._reset(),this._loadImage())},src:function(t){this._reset(),t&&this._loadImage()}},methods:{_reset:function(){var t,e;this.image=null,this.initWidth=0,this.initHeight=0,this.currentWidth=0,this.currentHeight=0,this.resizedWidth=0,this.resizedHeight=0,this.zoom=1,this.sX=null,this.sY=null,this.cCtx=this.$refs.cCanvas.getContext("2d"),this.pCtx=this.$refs.pCanvas.getContext("2d"),this.ratio=(t=this.cCtx,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,(window.devicePixelRatio||1)/e),this.$refs.pCanvas.width=window.innerWidth*this.ratio,this.$refs.pCanvas.height=window.innerHeight*this.ratio,this._setcCanvasRect(),this._getCropperInitialPosition()},_setcCanvasRect:function(){this.$refs.cCanvas.width=this.cropperWidth*this.ratio,this.$refs.cCanvas.height=this.cropperHeight*this.ratio},_getCropperInitialPosition:function(){var t=window.innerWidth,e=window.innerHeight;this.topX=t/2-this.cropperWidth/2,this.topY=e/2-this.cropperHeight/2},_isInCropperArea:function(t,e){return t>=this.topX&&t<=this.topX+this.cropperWidth&&e>=this.topY&&e<=this.topY+this.cropperHeight},_isInCropperAngle:function(t,e){return t>=this.topX-10&&t<=this.topX+15+10&&e>=this.topY-10&&e<=this.topY+15+10?s:t>=this.topX+this.cropperWidth-7.5-10&&t<=this.topX+this.cropperWidth+7.5+10&&e>=this.topY-10&&e<=this.topY+15+10?a:t>=this.topX-10&&t<=this.topX+15+10&&e>=this.topY+this.cropperHeight-7.5-10&&e<=this.topY+this.cropperHeight-7.5+10?h:t>=this.topX+this.cropperWidth-7.5-10&&t<=this.topX+this.cropperWidth+7.5+10&&e>=this.topY+this.cropperHeight-7.5-10&&e<=this.topY+this.cropperHeight-7.5+10&&c},_resizeCropper:function(t,e){switch(this.resizingCropper){case s:this.topX+=t,this.topY+=e,this.cropperWidth-=t,this.cropperHeight-=e;break;case a:this.topY+=e,this.cropperWidth+=t,this.cropperHeight-=e;break;case h:this.topX+=t,this.cropperWidth-=t,this.cropperHeight+=e;break;case c:this.cropperWidth+=t,this.cropperHeight+=e}this._setcCanvasRect(),this._drawCanvas()},isInLegalArea:function(t,e){return t>=this.sX&&t<this.sX+this.currentWidth&&e>=this.sY&&e<this.sY+this.currentHeight},_moveCropper:function(t,e){var i=!1;this.topX+t>=0&&this.topX+t+this.cropperWidth<=window.innerWidth&&(this.topX+=t,i=!0),this.topY+e>=0&&this.topY+e+this.cropperHeight<=window.innerHeight&&(this.topY+=e,i=!0),i&&this._drawCanvas()},_adjustImageSize:function(){var t=1;this.initWidth>window.innerWidth&&(t=window.innerWidth/this.initWidth),this.initHeight>window.innerHeight&&(t=Math.min(t,window.innerHeight/this.initHeight)),this.zoom=t,this.currentWidth=this.zoom*this.initWidth,this.currentHeight=this.zoom*this.initHeight,this.resizedWidth=this.currentWidth,this.resizedHeight=this.currentHeight},_loadImage:function(){var t=this,e=new Image;e.setAttribute("crossOrigin","Anonymous"),e.src=this.src,e.onload=function(){t.image=e,t.initWidth=e.width,t.initHeight=e.height,t._adjustImageSize(),t._drawCanvas()},e.onerror=function(){t.$emit("load-failed")}},_getStartPoint:function(){var t=(window.innerWidth-this.currentWidth)/2,e=(window.innerHeight-this.currentHeight)/2;this.sX=t,this.sY=e},_drawCanvas:function(t,e){var i=this.cCtx,r=this.pCtx,n=this.ratio,s=this.$refs.pCanvas,a=function(t){return"object"===o(t)&&null===t};(a(this.sX)||a(this.sY))&&this._getStartPoint();var h=this.topY,c=this.topX;t=t||this.currentWidth,e=e||this.currentHeight,r.fillStyle="#000",r.fillRect(0,0,s.width,s.height),r.drawImage(this.image,0,0,this.initWidth,this.initHeight,this.sX*n,this.sY*n,t*n,e*n),i.drawImage(this.$refs.pCanvas,c*n,h*n,this.cropperWidth*n,this.cropperHeight*n,0,0,this.cropperWidth*n,this.cropperHeight*n)},cropImage:function(){var t=this;try{var e=function(e){var i=document.createElement("canvas");return i.width=e.width/t.ratio,i.height=e.height/t.ratio,i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),i}(this.$refs.cCanvas).toDataURL(this.outputMime,this.outputQuality);"blob"===this.outputType&&(e=function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],r=atob(e[1]),n=r.length,o=new Uint8Array(n);n--;)o[n]=r.charCodeAt(n);return new Blob([o],{type:i})}(e)),this.$emit("crop-done",e)}catch(t){this.$emit("crop-failed",t)}},cancel:function(){this.$emit("update:visible",!1)}},mounted:function(){var t=this,e=new n.a(this.$refs.gesture,{pressMove:function(e){var i=e.touches[0],r=i.clientX,n=i.clientY;return t.resizingCropper?t._resizeCropper(e.deltaX,e.deltaY):t.movingCropper?t._moveCropper(e.deltaX,e.deltaY):void(t.isInLegalArea(r,n)&&(t.sX+=e.deltaX,t.sY+=e.deltaY,t._drawCanvas()))},pinch:function(e){var i=e.zoom*t.currentWidth,r=e.zoom*t.currentHeight;i>2*t.initWidth||r>2*t.initHeight||(t.sX+=(t.resizedWidth-i)/2,t.sY+=(t.resizedHeight-r)/2,t.resizedWidth=i,t.resizedHeight=r,t._drawCanvas(t.resizedWidth,t.resizedHeight))},touchStart:function(e){var i=e.touches[0].clientX,r=e.touches[0].clientY;t.resizingCropper=t.resizable&&t._isInCropperAngle(i,r),t.movingCropper=t._isInCropperArea(i,r)},touchEnd:function(e){t.currentWidth=t.resizedWidth,t.currentHeight=t.resizedHeight,t.resizingCropper=!1,t.movingCropper=!1}});this.$on("hook:beforeDestory",(function(){e=e.destory()})),this._reset()}}},function(e,i){e.exports=t},function(t,e,i){"use strict";i.r(e);var r=i(8),n=i.n(r);for(var o in r)"default"!==o&&function(t){i.d(e,t,(function(){return r[t]}))}(o);e.default=n.a},function(t,e,i){},function(t,e,i){"use strict";function r(t,e,i,r,n,o,s,a){var h,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),r&&(c.functional=!0),o&&(c._scopeId="data-v-"+o),s?(h=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=h):n&&(h=a?function(){n.call(this,this.$root.$options.shadowRoot)}:n),h)if(c.functional){c._injectStyles=h;var p=c.render;c.render=function(t,e){return h.call(e),p(t,e)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,h):[h]}return{exports:t,options:c}}i.r(e),i.d(e,"default",(function(){return r}))}]).default}));